---
layout: post
title: "Next.js í•™ìŠµ ì •ë¦¬"
date: 2020-08-15
author: Jason
categories: react
published: true
---

## Next.js

Next.js ëŠ” React.js ì˜ í”„ë ˆì„ì›Œí¬ì´ë©° ë‹¤ìŒê³¼ ê°™ì€ ê¸°ëŠ¥ë“¤ì„ ê°€ì§€ê³  ìˆë‹¤.

- ë” ë¹ ë¥¸ page load ë¥¼ ìœ„í•œ ìë™ code splitting ê³¼ prefetching ì§€ì›

- [Built-in CSS](https://nextjs.org/docs/basic-features/built-in-css-support) ê³¼ Sass ì§€ì›, ê·¸ë¦¬ê³  ëª¨ë“  CSS-in-JS ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì§€ì›

- pre-rendering (static generation(SSG) ì™€ server-side rendering (SSR) ëª¨ë‘ì—ì„œ) ë¥¼ ì§€ì›í•œë‹¤.

- ì§ê´€ì ì¸ [page-based](https://nextjs.org/docs/basic-features/pages) routing ì‹œìŠ¤í…œ ([dynamic routes](https://nextjs.org/docs/routing/dynamic-routes)ë¥¼ ì§€ì›í•œë‹¤.)

- fast page load (component state ìœ ì§€í•œì±„ë¡œ page re-load ë¨) ë¥¼ ì§€ì›

- Serverless Function ì˜ API endpoint ë¥¼ build í•˜ê¸° ìœ„í•œ [API routes](https://nextjs.org/docs/api-routes/introduction) ì§€ì›

- í™•ì¥ ê°€ëŠ¥ì„±

<br>

ìœ„ì— ë‚˜ì—´ëœ ê¸°ëŠ¥ë“¤ì„ í•˜ë‚˜ì”© ì¢€ ë” ìì„¸íˆ ì‚´í´ ë³´ì

## ğŸ“• code splitting ê³¼ prefetching

Next.js ëŠ” code splitting ì„ ìë™ìœ¼ë¡œ ìˆ˜í–‰í•œë‹¤. ì¦‰, ê° page ëŠ” í•´ë‹¹ page ì—ì„œ í•„ìš”í•œ ë¶€ë¶„ë§Œ render í•œë‹¤. ì˜ˆë¥¼ ë“¤ì–´, home page ê°€ render ë˜ì–´ ìˆì„ ë•Œ, ë‹¤ë¥¸ page ì˜ code ë“¤ì€ serve ë˜ì§€ ì•ŠëŠ”ë‹¤.

**ì´ë¥¼ í†µí•´ ìš°ë¦¬ì˜ app ì— ìˆ˜ë°±ê°œì˜ page ê°€ ìˆë”ë¼ë„ home page ëŠ” ë¹ ë¥´ê²Œ load ëœë‹¤.**

ì´ëŠ” ê°ê°ì˜ page ê°€ ë…ë¦½ë˜ì–´ ìˆìŒì„ ëœ»í•œë‹¤. ë§Œì•½ í•œ page ì—ì„œ error ê°€ ë°œìƒí•´ë„ app ì˜ ë‹¤ë¥¸ ë¶€ë¶„ë“¤ì€ ì—¬ì „íˆ ë™ì‘í•œë‹¤.

ì¶”ê°€ì ìœ¼ë¡œ, Next.js ì˜ production build ì—ì„œëŠ” ë¸Œë¼ìš°ì €ì˜ í™”ë©´ ìƒ `Link` ì»´í¬ë„ŒíŠ¸ê°€ ë°œê²¬ë˜ë©´ ìë™ìœ¼ë¡œ **ì—°ê²°ëœ page ì˜ ì½”ë“œë“¤ì„ background ì— prefetch í•œë‹¤.** `Link` ë¥¼ í´ë¦­í•œ ìˆœê°„ì—ëŠ” ì´ë¯¸ background ì— ì—°ê²°ëœ page ê°€ load ë˜ì–´ ìˆë‹¤. ì´ëŠ” page ì „í™˜ ì†ë„ë¥¼ ë§¤ìš° ì¦ê°€ì‹œí‚¨ë‹¤.

> **ì£¼ì˜ ì‚¬í•­**
>
> - Next.js app ì—ì„œ ì™¸ë¶€ page ë¥¼ ì—°ê²°í•  ë•ŒëŠ” `<Link>` ê°€ ì•„ë‹Œ `<a>` ë¥¼ ì‚¬ìš©í•  ê²ƒ
> - `className` ê³¼ ê°™ì€ attribute ëŠ” `<Link>` ëŒ€ì‹  `<a>` ì— ì¶”ê°€í•  ê²ƒ

<br>

**Next.js ëŠ” code splitting, client-side navigation ê·¸ë¦¬ê³  prefetching (in production) ì„ í†µí•´ ìë™ìœ¼ë¡œ app ì„ ìµœì í™” ì‹œí‚¨ë‹¤.**

<br>

## ğŸ“• CSS Styling

Styling ë°©ë²• ë‘ ê°€ì§€

- **CSS-in-JS**  
  [styled-jsx](https://nextjs.org/learn/basics/assets-metadata-css/css-styling)  
  styled-components  
  emotion

- [CSS Modules](https://nextjs.org/learn/basics/assets-metadata-css/layout-component)

> SASS ë¥¼ ì‚¬ìš©í•˜ë ¤ë©´ 'sass' ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ë°›ì•„ì•¼í•œë‹¤. (`.scss` ë¡œ CSS Modules ì„ ì‚¬ìš©í•  ë•Œë„ ë§ˆì°¬ê°€ì§€)

<br>

**Global css ì‚¬ìš© ë°©ë²•**

[`pages/_app.js`]() ë¥¼ ìƒì„±í•˜ê³  css íŒŒì¼ì„ í•´ë‹¹ ì»´í¬ë„ŒíŠ¸ì—ì„œ import í•œë‹¤.  
(`_app.js` ì»´í¬ë„ŒíŠ¸ëŠ” ëª¨ë“  ì»´í¬ë„ŒíŠ¸ì˜ ìµœìƒìœ„ ì»´í¬ë„ŒíŠ¸ë¡œ ìë™ìœ¼ë¡œ ì¸ì‹ë˜ê³  render ëœë‹¤.)

pages/\_app.js ì½”ë“œ

```javascript
import "../styles/global.css";

export default function App({ Component, pageProps }) {
  return <Component {...pageProps} />;
}
```

**pages/\_app.js ë¥¼ ì¶”ê°€í•˜ë©´ dev server ë¥¼ ë°˜ë“œì‹œ restart í•´ì•¼í•œë‹¤.**

<br>

## ğŸ“• Pre-rendering

Next.js ëŠ” ê¸°ë³¸ì ìœ¼ë¡œ ëª¨ë“  page ë¥¼ **pre-render** í•œë‹¤. ì¦‰, client-side JavaScript ëŒ€ì‹  Next.js ê°€ ê° page ì˜ HTML ì„ ë¯¸ë¦¬ ìƒì„±í•œë‹¤ëŠ” ì˜ë¯¸ì´ë‹¤.  
**Pre-rendering ì€ ë” ì¢‹ì€ performance ì™€ SEO ë¥¼ ì´ëŒì–´ë‚¼ ìˆ˜ ìˆë‹¤.**

ìƒì„±ëœ ê°ê°ì˜ HTML ì€ í•´ë‹¹ page ì— í•„ìˆ˜ì ì¸ ìµœì†Œí•œì˜ JavaScript ì½”ë“œì™€ ê´€ë ¨ì´ ìˆë‹¤.  
page ê°€ browser ì— ì˜í•´ load ë˜ë©´, í•´ë‹¹ page ì˜ JavaScript ì½”ë“œê°€ ì‹¤í–‰ë˜ë©´ì„œ page ë¥¼ ì™„ì „íˆ interactive í•˜ê²Œ ë§Œë“ ë‹¤. (ì´ ì¼ë ¨ì˜ ê³¼ì •ì´ **Hydration** ì´ë‹¤.)

<br>

**âœ… Pre-rendering í™•ì¸ ë°©ë²•**

ì•„ë˜ì˜ ìˆœì„œë¥¼ ë”°ë¥¸ë‹¤.

1. browser ì—ì„œ JavaScript ë¥¼ disable ì‹œí‚¨ë‹¤. ([í¬ë¡¬ì—ì„œ í•˜ëŠ” ë°©ë²•](https://developers.google.com/web/tools/chrome-devtools/javascript/disable))

2. [ë§í¬](https://create-react-app.now-examples.now.sh/)ë¡œ ì´ë™í•´ë³¸ë‹¤.  
   í•´ë‹¹ page ëŠ” CRA ë¡œ build ëœ plain React.js app ì´ë‹¤. **ì¦‰, pre-render ê¸°ëŠ¥ì´ ì—†ì–´ JavaScript ê°€ disabled ëœ ì±„ë¡œëŠ” page ë¥¼ render í•  ìˆ˜ ì—†ë‹¤.**

3. ì´ë²ˆì—ëŠ” ë‹¤ìŒ [ë§í¬](https://next-learn-starter.now.sh/)ë¡œ ì´ë™í•œë‹¤.  
   **í•´ë‹¹ page ëŠ” Next.js ë¡œ ì´ë£¨ì–´ì ¸ ìˆìœ¼ë¯€ë¡œ JavaScript ê°€ disabled ëœ ì±„ë¡œë„ pre-render ëœ HTML ì„ ë¬¸ì œì—†ì´ ë³´ì—¬ì¤€ë‹¤.**

<br>

Pre-rendering ì˜ ë™ì‘ ì›ë¦¬ë¥¼ ê·¸ë¦¼ìœ¼ë¡œ í™•ì¸í•´ë³´ì.

- **Pre-rendering**  
   ìµœì´ˆ Load ì‹œ HTML ì„ Pre-render í•´ì„œ ë³´ì—¬ì¤€ë‹¤.  
   JS ê°€ ì‹¤í–‰ë˜ë©´ì„œ React ì»´í¬ë„ŒíŠ¸ê°€ ì´ˆê¸°í™” ë˜ê³  page ë¥¼ interactive í•˜ê²Œ ë§Œë“ ë‹¤. (**Hydration**)

  <a href="https://user-images.githubusercontent.com/52827441/90326486-c4b47900-dfc3-11ea-8892-2b02aee5cc0b.png" data-lightbox="pre-rendering" data-title="pre-rendering">
  <img src="https://user-images.githubusercontent.com/52827441/90326486-c4b47900-dfc3-11ea-8892-2b02aee5cc0b.png" alt="pre-rendering" style="height: 280px; width: auto;"/>
  </a>

- **No Pre-rendering (ìˆœìˆ˜ React app)**  
  ìµœì´ˆ Load ì‹œ render í•  HTML ì´ ì—†ë‹¤.  
  JS ê°€ ì‹¤í–‰ë˜ë©´ì„œ React ì»´í¬ë„ŒíŠ¸ê°€ ì´ˆê¸°í™” ë˜ê³  page ë¥¼ interactive í•˜ê²Œ ë§Œë“ ë‹¤. (**Hydration**)

  <a href="https://user-images.githubusercontent.com/52827441/90326529-35f42c00-dfc4-11ea-8c4a-6d56d6851e96.png" data-lightbox="no pre-rendering" data-title="no pre-rendering">
  <img src="https://user-images.githubusercontent.com/52827441/90326529-35f42c00-dfc4-11ea-8c4a-6d56d6851e96.png" alt="no pre-rendering" style="height: 280px; width: auto;"/>
  </a>

<br>

## ğŸ“• Data Fetching

### Build-time data fetching

static generation (ì •ì  HTML ìƒì„±) ì‹œ ì™¸ë¶€ Data ë¥¼ ë¶ˆëŸ¬ì™€ render í•  ìˆ˜ ìˆë‹¤.  
ì˜ˆë¥¼ ë“¤ì–´ file system ì— ì ‘ê·¼í•˜ê±°ë‚˜ ì™¸ë¶€ API ë˜ëŠ” database ì— query ë¥¼ ë³´ë‚´ëŠ” ë“±ì˜ ì‘ì—…ì´ í•„ìš”í•œ ê²½ìš°ì´ë‹¤.

  <a href="https://user-images.githubusercontent.com/52827441/90390581-8e135700-e0c6-11ea-88ff-156812ffe95d.png" data-lightbox="fetching data" data-title="fetching data">
  <img src="https://user-images.githubusercontent.com/52827441/90390581-8e135700-e0c6-11ea-88ff-156812ffe95d.png" alt="fetching data" style="height: 350px; width: auto;"/>
  </a>

ì´ëŸ° ê²½ìš° Next.js ì— ë‚´ì¥ëœ `getStaticProps` ë¼ëŠ” ë¹„ë™ê¸° í•¨ìˆ˜ë¥¼ ì‚¬ìš©í•œë‹¤.

- `getStaticProps` ëŠ” production mode ì—ì„œ **build ì‹œì— ì‹¤í–‰**ëœë‹¤.
- í•¨ìˆ˜ ë‚´ë¶€ì—ì„œ ì™¸ë¶€ data ë¥¼ fetch í•´ì˜¤ê³  page ì˜ props ë¡œ ë³´ë‚¼ ìˆ˜ ìˆë‹¤.

êµ¬ì¡°ëŠ” ë‹¤ìŒê³¼ ê°™ë‹¤.

```javascript
// Home ì»´í¬ë„ŒíŠ¸
export default function Home(props) { ... }

// getStaticProps() í•¨ìˆ˜
export async function getStaticProps() {
  // file system, API, DB ë“±ìœ¼ë¡œ ë¶€í„° ì™¸ë¶€ data ë¥¼ ë¶ˆëŸ¬ì˜¨ë‹¤.
  const data = ...

  // return ë˜ëŠ” ê°ì²´ì˜ 'props' key ì˜ value ëŠ”
  // ìë™ìœ¼ë¡œ 'Home' ì»´í¬ë„ŒíŠ¸ì˜ props ë¡œ ì „ë‹¬ëœë‹¤.
  return {
    props: ...
  }
}
```

ì¦‰, `getStaticProps` ëŠ” Next.js ì—ê²Œ í•´ë‹¹ page ì— **data ì˜ì¡´ì„±ì´ ì¡´ì¬**í•˜ëŠ” ê²ƒì„ ì•Œë¦¬ê³  build ì¤‘ pre-render ì‹œì— ê·¸ ê²ƒì„ ë¨¼ì € í•´ê²°í•˜ë„ë¡ í•œë‹¤.

> development mode ì—ì„œëŠ” í¸ì˜ ìƒ ë§¤ ìš”ì²­ë§ˆë‹¤ `getStaticProps` ê°€ ì‹¤í–‰ëœë‹¤.

`getStaticProps` ë¥¼ í†µí•´ ì™¸ë¶€ API ì™€ Database ì— ì ‘ê·¼í•  ìˆ˜ ìˆëŠ” ì´ìœ ëŠ” ì´ í•¨ìˆ˜ê°€ ì˜¤ì§ **server-side** ì—ì„œë§Œ ì‹¤í–‰ë˜ê¸° ë•Œë¬¸ì´ë‹¤. ì ˆëŒ€ client-side ì—ì„œëŠ” ì‹¤í–‰ë˜ì§€ ì•ŠëŠ”ë‹¤. **ì¦‰, browser ì˜ JS bundler ì—ë„ í¬í•¨ë˜ì§€ ì•ŠëŠ”ë‹¤.** ê·¸ëŸ¬ë¯€ë¡œ database ì— ì§ì ‘ ë³´ë‚´ëŠ” query ì™€ ê°™ì€ ì½”ë“œë¥¼ browser ì— ë³´ë‚´ì§€ ì•Šê³ ë„ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤.

<br>

**ì˜¤ì§ Page ì—ì„œë§Œ ì‚¬ìš© ê°€ëŠ¥í•˜ë‹¤.**

`getStaticProps`ëŠ”`pages` í´ë” ë‚´ì˜ page íŒŒì¼ì—ì„œë§Œ export ê°€ëŠ¥í•˜ë‹¤.

ê·¸ ì´ìœ  ì¤‘ í•˜ë‚˜ëŠ” React ê°€ page ë¥¼ render í•˜ê¸° ì „ì— ëª¨ë“  data ë¥¼ í•„ìš”ë¡œ í•˜ê¸° ë•Œë¬¸ì´ë‹¤.

<br>

**Development ëª¨ë“œ VS. Production ëª¨ë“œ**

- development ëª¨ë“œì—ì„œëŠ” `getStaticProps` ê°€ ë§¤ ìš”ì²­(request)ë§ˆë‹¤ ì‹¤í–‰ëœë‹¤.

- production ëª¨ë“œì—ì„œëŠ” build ì‹œì— ì‹¤í–‰ëœë‹¤.

**build ì‹œì— ì‹¤í–‰ë˜ëŠ” ê²ƒì´ ì›ë˜ì˜ ëª©ì ì´ë¯€ë¡œ** request ì‹œì—ë§Œ ì‚¬ìš© ê°€ëŠ¥í•œ data ë“¤ì—ëŠ” ì ‘ê·¼í•  ìˆ˜ ì—†ë‹¤. ì˜ˆë¥¼ ë“¤ì–´ query parameter(url) ë‚˜ HTTP header ì˜ data ì— ì ‘ê·¼í•  ìˆ˜ ì—†ë‹¤.

<br>

### Request-time data fetching

ë§Œì•½ **request ì‹œì— data fetching ê³¼ HTML ìƒì„±ì´ í•„ìš”í•˜ë‹¤ë©´ Server-side Rendering ì„ í•˜ëŠ” ê²ƒì´ ì¢‹ë‹¤.**

server-side Rendering ì„ í•˜ê¸° ìœ„í•´ì„œëŠ” `getServerSideProps` ë¥¼ ì‚¬ìš©í•œë‹¤.

```javascript
function Page({ data }) {
  // Render data...
}

// This gets called on every request
export async function getServerSideProps() {
  // Fetch data from external API
  const res = await fetch(`https://.../data`);
  const data = await res.json();

  // Pass data to the page via props
  return { props: { data } };
}

export default Page;
```

<br>

**`getServerSideProps` ì˜ íŠ¹ì§•**

- `getServerSideProps` ê°€ request ì‹œì— í˜¸ì¶œë˜ë¯€ë¡œ, ë§¤ê°œë³€ìˆ˜ì¸ `context` ëŠ” request ì˜ ì„¸ë¶€ parameter ë¥¼ ë‹´ê³  ìˆë‹¤.

- `getServerSideProps` ëŠ” request ì‹œì— ì™¸ë¶€ data fetching ì´ í•„ìš”í•œ page ë¥¼ pre-render í•´ì•¼í•  ë•Œë§Œ ì‚¬ìš©í•´ì•¼ í•œë‹¤.

- server ê°€ ë§¤ request result ë¥¼ ì—°ì‚°í•´ì•¼í•˜ê¸° ë•Œë¬¸ì—, [TTFB](https://constant.kr/blog/2018/08/14/ttfb%EB%9E%80-ttfb%EB%8A%94-%EA%B2%80%EC%83%89%EC%97%94%EC%A7%84%EC%B5%9C%EC%A0%81%ED%99%94%EC%99%80-%EB%AC%B4%EC%8A%A8-%EC%83%81%EA%B4%80%EC%9D%BC%EA%B9%8C/)(Time To First Byte) ëŠ” `getStaticProps` ë³´ë‹¤ ëŠë ¤ì§„ë‹¤.

- result ëŠ” ì¶”ê°€ì ì¸ configuration ì—†ì´ëŠ” [CDN](https://cdn.hosting.kr/cdn%EC%9D%B4%EB%9E%80-%EB%AC%B4%EC%97%87%EC%9D%B8%EA%B0%80%EC%9A%94/) ì— cache ë  ìˆ˜ ì—†ë‹¤.

<br>

**Client-side Rendering**

ë§Œì•½ data ë¥¼ pre-render í•  í•„ìš”ê°€ ì—†ê³  data ê°€ ìì£¼ update ë˜ì–´ì•¼ í•œë‹¤ë©´, [Client-side Rendering](https://nextjs.org/docs/basic-features/data-fetching#fetching-data-on-the-client-side) ì„ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤.

- ì™¸ë¶€ data ê°€ í•„ìš”í•˜ì§€ ì•Šì€ page ì˜ ì¼ë¶€ë¥¼ ì •ì  ìƒì„±ì„ ì‚¬ìš©í•´ pre-render í•œë‹¤. (loading ui ë¥¼ ì‚¬ìš©í•´ data ê°€ render ë  ë¶€ë¶„ì„ í‘œì‹œí•  ìˆ˜ ìˆë‹¤.)
- page ê°€ load ë˜ë©´, client ì—ì„œ JavaScript ë¥¼ ì‚¬ìš©í•´ ì™¸ë¶€ data ë¥¼ fetch í•˜ê³  ë‚¨ì€ ë¶€ë¶„ì„ ìƒì„±í•´ page ì— ë¶™ì¸ë‹¤.

> Vanilla JS ë¥¼ ì‚¬ìš©í•œ ê¸°ì´ˆì ì¸ Web app ì˜ ê²½ìš°ì¸ ê²ƒ ê°™ë‹¤.

client-side rendering ê·¸ë¦¼ìœ¼ë¡œ ì´í•´í•˜ê¸°

  <a href="https://user-images.githubusercontent.com/52827441/90411400-ae530e00-e0e6-11ea-858e-1194a243f340.png" data-lightbox="client-side rendering" data-title="client-side rendering">
  <img src="https://user-images.githubusercontent.com/52827441/90411400-ae530e00-e0e6-11ea-858e-1194a243f340.png" alt="client-side rendering" style="height: 800px; width: auto;"/>
  </a>

**client-side rendering ì‚¬ìš© ì˜ˆ**

user dashboard page ë¥¼ ì˜ˆë¡œ ë“¤ ìˆ˜ ìˆë‹¤. user ì˜ ê°œì¸ì •ë³´ê°€ í¬í•¨ëœ page ì´ë¯€ë¡œ SEO ì™€ ê´€ë ¨ì´ ì—†ê³  pre-render ë˜í•œ í•„ìš” ì—†ê¸° ë•Œë¬¸ì´ë‹¤.  
(data ëŠ” ë¹ˆë²ˆí•˜ê²Œ update ë˜ë¯€ë¡œ request-time data fetching ì´ í•„ìš”í•˜ë‹¤.)

<br>

### Data Fetching í•œ ì¤„ ìš”ì•½

**Build-time data fetching**

- `getStaticProps` : production ëª¨ë“œì¼ ë•Œ build ì‹œ server-side ì—ì„œ ì‹¤í–‰ë˜ëŠ” í•¨ìˆ˜

**Request-time data fetching**

- Server-side Rendering : `getServerSideProps` í•¨ìˆ˜ / request ì‹œ ì™¸ë¶€ data fetching ì´ í•„ìš”í•œ page ë¥¼ pre-render í•  ë•Œ ì‚¬ìš©

- Client-side Rendering : SEO ì™€ ê´€ë ¨ ì—†ê³  data ê°€ ìì£¼ update ë¼ì•¼ í•  ê²½ìš° ì‚¬ìš©

## Reference

[Next.js ê³µì‹ ë¬¸ì„œ](https://nextjs.org)

[Server-side rendering ê³¼ Client-side rendering ì˜ ê°œë… ì„¤ëª…](https://jaroinside.tistory.com/24)
